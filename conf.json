{  
    "process_name": "flujo1",
    "hive_database": "pruebas_cuadre",
    "stages": [
        {
            "stage_name": "stage1",
            "inputs": [
                {
                    "source": "EXPERTO_NOMBRES",
                    "destination": "EXPERTOS1",
                    "filters":[
                        {"expression" : "fechacomprobanteok = '2017-08-16'"}
                    ]
                },
                {
                    "source": "CDAV_NOMBRES_CANJE",
                    "destination": "CDAVS1",
                    "filters":[
                        {"expression" : "fec_proc_ok = '2017-08-16'"}
                    ]
                }
            ],
            "steps":[
                {
                    "inputs": [],
                    "type":"join",
                    "join_type":"FULL OUTER JOIN",
                    "source_table":"EXPERTOS1",
                    "destination_table":"CDAVS1",
                    "join":[
                        {"source": "nrocuenta","destination":"tnum_tarje"},
                        {"source": "fechacomprobanteok","destination":"fec_proc_ok"},
                        {"source": "valorok","destination":"cdav_valor"}
                    ],
                    "outputs":[
                        {
                            "table": "S1ST1NM",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "expertos1_nrocuenta is null or cdavs1_tnum_tarje is null"}
                            ]
                        },
                        {
                            "table": "S1NMEXPERTO",
                            "persist": "TRUE",
                            "persist_method": "REPLACE",
                            "filters":[
                                {"expression" : "expertos1_nrocuenta is null or cdavs1_tnum_tarje is null"},
                                {"expression" : "expertos1_nrocuenta is not null"}
                            ]
                        },
                        {
                            "table": "S1NMCDAV",
                            "persist": "TRUE",
                            "persist_method": "REPLACE",
                            "filters":[
                                {"expression" : "expertos1_nrocuenta is null or cdavs1_tnum_tarje is null"},
                                {"expression" : "cdavs1_tnum_tarje is not null"}
                            ]
                        },
                        {
                            "table": "S1ST1M",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "expertos1_nrocuenta is not null and cdavs1_tnum_tarje is not null"}
                            ]
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "source": "S1NMEXPERTO",
                            "destination": "EXPERTOS2",
                            "filters":[
                                {"expression" : "S1NMEXPERTO_tarjeta_2 is not null"},
                                {"expression" : "S1NMEXPERTO_tarjeta_2 <> ''"}
                            ]
                        },
                        {
                            "source": "S1NMCDAV",
                            "destination": "CDAVS2",
                            "filters":[
                                {"expression" : "S1NMCDAV_tarjeta_2 is not null"},
                                {"expression" : "S1NMCDAV_tarjeta_2 <> ''"}
                            ]
                        }
                    ],
                    "type":"join",
                    "join_type":"FULL OUTER JOIN",
                    "source_table":"EXPERTOS2",
                    "destination_table":"CDAVS2",
                    "join":[
                        {"source": "S1NMEXPERTO_tarjeta_2","destination":"S1NMCDAV_tarjeta_2"},
                        {"source": "S1NMEXPERTO_fechacomprobanteok","destination":"S1NMCDAV_fec_proc_ok"},
                        {"source": "S1NMEXPERTO_valorok","destination":"S1NMCDAV_cdav_valor"}
                    ],
                    "outputs":[
                        {
                            "table": "STAGE1_NOMATCH_STEP2",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta is null or cdavs2_S1NMCDAV_tnum_tarje is null"},
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta <> cdavs2_S1NMCDAV_tnum_tarje"}
                            ]
                        },
                        {
                            "table": "STAGE1_NOMATCH_EXPERTO",
                            "persist": "TRUE",
                            "persist_method": "REPLACE",
                            "filters":[
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta is null or cdavs2_S1NMCDAV_tnum_tarje is null"},
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta <> cdavs2_S1NMCDAV_tnum_tarje"},
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta is not null"}
                            ]
                        },
                        {
                            "table": "STAGE1_NOMATCH_CDAV",
                            "persist": "TRUE",
                            "persist_method": "REPLACE",
                            "filters":[
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta is null or cdavs2_S1NMCDAV_tnum_tarje is null"},
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta <> cdavs2_S1NMCDAV_tnum_tarje"},
                                {"expression" : "cdavs2_S1NMCDAV_nrocuenta is not null"}
                            ]
                        },
                        {
                            "table": "STAGE1_MATCH_STEP2",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta is not null and cdavs2_S1NMCDAV_tnum_tarje is not null"},
                                {"expression" : "expertos2_S1NMEXPERTO_nrocuenta <> cdavs2_S1NMCDAV_tnum_tarje"}
                            ]
                        }
                    ]
                },
                {
                    "inputs": [],
                    "type": "merge",
                    "destionation_table": "",
                    "destination_columns":[
                        ""
                    ] ,
                    "source_tables": [
                        {
                            "table":"",
                            "columns":{
                                "":""
                            }
                        }
                    ],
                    "outputs":[]
                }
            ]
        },
        {
            "stage_name": "stage2",
            "inputs": [
                {
                    "source": "STAGE1_NOMATCH_STEP1",
                    "destination": "EXPERTO_NM",
                    "filters":[
                        {"expression" : "experto_nrocuenta is not null"}
                    ]
                },
                {
                    "source": "STAGE1_NOMATCH_STEP1",
                    "destination": "CDAV_NM",
                    "filters":[
                        {"expression" : "cdav_tnum_tarje is not null"}
                    ]
                }
            ],
            "steps":[
                {
                    "inputs": [],
                    "type":"join",
                    "join_type":"FULL OUTER JOIN",
                    "source_table":"EXPERTO_NM",
                    "destination_table":"CDAV_NM",
                    "join":[
                        {"source": "experto_nrocuenta","destination":"cdav_tnum_tarje"},
                        {"source": "experto_valorok","destination":"cdav_cdav_valor"}
                    ],
                    "outputs":[
                        {
                            "table": "STAGE2_NOMATCH_STEP1",
                            "persist": "TRUE",
                            "filters":[
                                {"expression" : "experto_nm_experto_nrocuenta is null or cdav_nm_cdav_tnum_tarje is null"}
                            ]
                        },
                        {
                            "table": "STAGE2_MATCH_STEP1",
                            "persist": "TRUE",
                            "filters":[
                                {"expression" : "experto_nm_experto_nrocuenta is not null and cdav_nm_cdav_tnum_tarje is not null"}
                            ]
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "source": "EXPERTO_NM",
                            "destination": "EXPERTO_NM",
                            "filters":[
                                {"expression" : "experto_tarjeta_2 is not null"},
                                {"expression" : "experto_tarjeta_2 <> ''"}
                            ]
                        },
                        {
                            "source": "CDAV_NM",
                            "destination": "CDAV_NM",
                            "filters":[
                                {"expression" : "cdav_tarjeta_2 is not null"},
                                {"expression" : "cdav_tarjeta_2 <> ''"}
                            ]
                        }
                    ],
                    "type":"join",
                    "join_type":"FULL OUTER JOIN",
                    "source_table":"EXPERTO_NM",
                    "destination_table":"CDAV_NM",
                    "join":[
                        {"source": "experto_tarjeta_2","destination":"cdav_tarjeta_2"},
                        {"source": "experto_valorok","destination":"cdav_cdav_valor"}
                    ],
                    "outputs":[
                        {
                            "table": "STAGE2_NOMATCH_STEP2",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "experto_nm_experto_nrocuenta is null or cdav_nm_cdav_tnum_tarje is null"},
                                {"expression" : "experto_nm_experto_nrocuenta <> cdav_nm_cdav_tnum_tarje"}
                            ]
                        },
                        {
                            "table": "STAGE2_MATCH_STEP2",
                            "persist": "TRUE",
                            "persist_method": "APPEND",
                            "filters":[
                                {"expression" : "experto_nm_experto_nrocuenta is not null and cdav_nm_cdav_tnum_tarje is not null"},
                                {"expression" : "experto_nm_experto_nrocuenta <> cdav_nm_cdav_tnum_tarje"}
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}


